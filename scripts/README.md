# Scripts Directory

This directory contains **one-time utility scripts** for the BacDive Assay Metadata project.

## Available Scripts

### `apply_fixes.py` - ONE-TIME USE ONLY

⚠️ **This is a one-time data cleanup utility, not part of the regular workflow.**

Automatically applies all validation fixes to the curated mappings in `src/bacdive_assay_metadata/mappers.py`.

**Usage:**
```bash
# From project root (one-time only)
uv run python3 scripts/apply_fixes.py
```

## Workflow Context

### Initial Cleanup (One-Time)
1. ✅ Run validation: `make validate`
2. ✅ Review errors in validation reports
3. ✅ **Run this script once**: `uv run python3 scripts/apply_fixes.py`
4. ✅ Verify fixes: `make validate` (should show 0 errors)
5. ✅ **Update source Google Sheets with corrected values**

### Future Updates (Regular Workflow)
1. ✅ Update Google Sheets with new/corrected data
2. ✅ Export to XLSX
3. ✅ Process XLSX → JSON
4. ✅ Run validation: `make validate`
5. ✅ If errors found → fix in Google Sheets (not with this script)

**Key Point**: This script fixes the **initial** dataset. Future updates come from corrected Google Sheets, so errors should not recur.

**What it does:**
1. Creates automatic backup of `mappers.py` with timestamp
2. Applies 11 fixes:
   - 3 critical errors (invalid CHEBI/PubChem IDs)
   - 2 deprecated CHEBI IDs
   - 1 obsolete GO term
   - 5 deprecated EC numbers (3 unique, 5 occurrences)
3. Generates `FINAL_FIXED_MAPPING_STATS.md` report
4. Shows detailed summary of all changes

**Safety:**
- Backup created automatically before any changes
- Exits with error if any fix fails to apply
- All changes are deterministic and traceable

**After running:**
```bash
make validate  # Should show: 0 errors, 0 warnings ✅
```

## Fixes Applied

### Critical Errors (3)
1. **5-Ketogluconic acid**: CHEBI:17991→17426 + PubChem:160957→5460352
2. **D-Tagatose**: CHEBI:17004→16443
3. **Cyclodextrin**: CHEBI:495083→40585 + add PubChem:444041

### Deprecated Terms (8)
**CHEBI (2)**:
- Dulcitol: CHEBI:42118→16813
- D-Lyxose: CHEBI:12301→62318

**GO (1)**:
- Gamma-glutamyl transferase: GO:0003840→0036374

**EC (3 unique, 5 occurrences)**:
- Cytochrome oxidase (×2): EC:1.9.3.1→7.1.1.9
- Nitrate reductase: EC:1.7.99.4→1.7.5.1
- Gelatinase (×2): EC:3.4.24.4→3.4.24.24

## References

See also:
- `../VALIDATION_ERRORS_DETAILED.md` - Detailed error analysis
- `../DEPRECATED_TERMS_REPORT.md` - Deprecated term analysis
- `../FINAL_MAPPING_STATS.md` - Pre-fix statistics
- `../FINAL_FIXED_MAPPING_STATS.md` - Post-fix statistics (generated by script)
